<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inbox - OneMail</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .animate-fade-in-scale {
      animation: fadeInScale 0.25s ease-out forwards;
    }
    @keyframes fadeInScale {
      0% { opacity: 0; transform: scale(0.95); }
      100% { opacity: 1; transform: scale(1); }
    }
  </style>
  <script>
    function openModal(id) {
      document.getElementById('confirmModal-' + id).classList.remove('hidden');
    }
    function closeModal(id) {
      document.getElementById('confirmModal-' + id).classList.add('hidden');
    }
  </script>
</head>
<body class="bg-gray-50 min-h-screen text-gray-900 select-none">

  <!-- Header -->
  <header class="bg-white border-b shadow-sm sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-blue-700">OneMail</h1>
      <nav class="space-x-4 text-sm font-medium">
        <a href="{{ url_for('send_mail') }}" class="text-blue-600 hover:underline">New Mail</a>
        <a href="{{ url_for('logout') }}" class="text-red-500 hover:underline">Logout</a>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-4xl mx-auto px-6 py-10">
    {% if mails %}
      <div class="space-y-6">
        {% for mail in mails %}
        <article class="bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md transition-all duration-300">
          <div onclick="location.href='{{ url_for('view_mail', folder='inbox', mail_id=mail['id']) }}'"
               class="p-5 cursor-pointer group">
            <div class="flex justify-between items-center mb-1">
              <h2 class="text-base font-semibold text-gray-800 truncate max-w-[70%]" title="{{ mail['from'] }}">
                {{ mail['from'] }}
                {% if mail.verified %}
                  <img src="{{ url_for('static', filename='verified.png') }}" alt="âœ”" class="inline-block w-5 h-5 ml-1 align-text-bottom" />
                {% endif %}
                {% if mail.emoji %}
                  <img src="{{ url_for('static', filename='emojis/' + mail.emoji) }}" alt="emoji" class="inline-block w-5 h-5 ml-1 align-text-bottom" />
                {% endif %}
              </h2>
              <span class="text-sm text-gray-500 whitespace-nowrap">
                {{ mail['timestamp'] }}
              </span>
            </div>
            <p class="text-sm text-gray-600 leading-relaxed line-clamp-2" title="{{ mail['message'] }}">
              {{ mail['message'] }}
            </p>
          </div>
          <div class="bg-gray-50 border-t px-5 py-3 flex justify-end">
            <button onclick="event.stopPropagation(); openModal('{{ mail['id'] }}')"
                    class="text-sm text-red-600 hover:text-red-700 font-medium transition">
              Delete
            </button>
          </div>
        </article>

        <!-- Delete Modal -->
        <div id="confirmModal-{{ mail['id'] }}"
             class="fixed inset-0 z-50 hidden bg-black/40 backdrop-blur-sm flex items-center justify-center p-4">
          <div class="bg-white w-full max-w-sm rounded-lg shadow-lg p-6 animate-fade-in-scale">
            <h3 class="text-lg font-semibold mb-3 text-gray-800">Delete Mail</h3>
            <p class="text-sm text-gray-600 mb-6">Are you sure you want to delete this mail?</p>
            <div class="flex justify-end space-x-3">
              <button onclick="closeModal('{{ mail['id'] }}')"
                      class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-md text-sm">
                Cancel
              </button>
              <form method="POST" action="{{ url_for('delete_mail_route', folder='inbox', mail_id=mail['id']) }}" class="inline">
                <button type="submit"
                        class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md text-sm">
                  Delete
                </button>
              </form>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-center text-gray-500 mt-20 text-base">Your inbox is empty.</p>
    {% endif %}
  </main>
</body>
</html>